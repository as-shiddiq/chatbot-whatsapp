<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>ChatBot</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-4Q6Gf2aSP4eDXB8Miphtr37CMZZQ5oXLH2yaXMJ2w8e2ZtHTl7GptT4jmndRuHDT" crossorigin="anonymous">
</head>

<body>
    <div class="container p-3 d-flex justify-content-between flex-column" style="height: 100vh;">
        <div>
            <img src="/assets/logo.png" alt="" height="100px">
            <div>
                <ul id="chat"></ul>
                <button class="btn-primary btn btn-sm" onclick="sendMessage()">Kirim</button>
            </div>
        </div>
        <div>
            <small class="info-ws"></small>
        </div>
    </div>
</body>

<script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-j1CDi7MgGQ12Z7Qab0qlWQ/Qqz24Gc6BM0thvEMVjHnfYGF0rmFCozFSxQBxwHKO"
    crossorigin="anonymous"></script>
<script type="text/javascript">
    // Ambil query string ?from=... dari URL
    const urlParams = new URLSearchParams(window.location.search);
    const token = urlParams.get('token') || 'anonymous';
    let elInfoWs = document.querySelector('.info-ws');

    // Inisialisasi koneksi socket dengan query userId
    const socket = io("http://localhost:3000", {
        query: { userId: token }
    });

    socket.on("connect", () => {
        elInfoWs.innerHTML = "Connected to WebSocket";
        elInfoWs.classList.add('text-success');
    });

    socket.on("message", (msg) => {
        const chat = document.getElementById("chat");
        const li = document.createElement("li");
        li.textContent = msg;
        chat.appendChild(li);
    });

    function sendMessage() {
        const msg = "halo gus";
        socket.emit("cl.sendMessage", { token: token, message: msg });
    }

    socket.on("sv.forwardMessage", (msg) => {
        console.log("Dari server:", msg);
    });

    socket.on("disconnect", (reason) => {
        elInfoWs.innerHTML = `Disconnected from WebSocket: ${reason}`;
        elInfoWs.classList.add('text-danger');
    });
</script>

</html>